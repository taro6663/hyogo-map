<!DOCTYPE html>
<html>
<head>
  <title>おでかけ兵庫MAP Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
    .gm-style-iw {
      max-width: 250px;
    }
    body {
      margin: 0;
      font-family: sans-serif;
    }
    .insta-link {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-top: 4px;
    }
    .insta-link img {
      width: 16px;
      height: 16px;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    let activeInfoWindow;

    async function initMap() {
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 15,
        center: { lat: 34.746, lng: 135.359 },
      });

      const response = await fetch("https://script.google.com/macros/s/AKfycbw0Q-YEkBPQ3v6lMiFKOjIDy9wGwqQpWTsXZvQd_z6qM-z4EfCXH69Ds5m8CvsI-fI1/exec");
      const mapData = await response.json();

      mapData.forEach(place => {
        if (!place.lat || !place.lng) return;

        const marker = new google.maps.Marker({
          position: { lat: parseFloat(place.lat), lng: parseFloat(place.lng) },
          map,
          title: place.name,
        });

        const infoWindow = new google.maps.InfoWindow({
          content: `
            <strong>${place.name}</strong><br>
            ${place.access}<br>
            営業時間: ${place.time}<br>
            <a href='${place.sns}' class='insta-link' target='_blank' rel='noopener noreferrer'>
              <img src='https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png' alt='Instagram'>
              Instagram
            </a>
          `
        });

        marker.addListener("click", () => {
          if (activeInfoWindow) {
            activeInfoWindow.close();
          }
          infoWindow.open(map, marker);
          activeInfoWindow = infoWindow;
        });
      });
    }
  </script>

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCXxn4fLU6ns7JcbfxUAn9KFOA7ts86LBM&callback=initMap"></script>
</body>
</html>
